<!DOCTYPE html>

<html lang="es">



<head>

Â  Â  <meta charset="UTF-8" />

Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />

Â  Â  <title>Calculadora de Factura - Cereales</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

Â  Â 

Â  Â  <link rel="stylesheet" href="css/style.css" />

Â  Â 

</head>



<body class="bg-[#fefcf6] font-inter min-h-screen flex flex-col items-center p-4">

Â  Â  <div id="app-container" class="w-full max-w-3xl bg-white p-6 rounded-xl shadow-md">

Â  Â  Â  Â  <!-- Contenedor del header con fondo del nuevo color -->

Â  Â  Â  Â  <div class="bg-[#1f2937] p-6 -m-6 mb-6 rounded-t-xl text-white">

Â  Â  Â  Â  Â  Â  <img src="assets/img/logo-mc-negocios.png" alt="Logo de MC Negocios"

Â  Â  Â  Â  Â  Â  Â  Â  class="w-full max-w-[200px] mx-auto mb-6 rounded-lg" />

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>

Â  Â  Â  Â  Â  Â  <h1 class="text-3xl font-bold text-center">Registro de Compra de Cereal</h1>

Â  Â  Â  Â  </div>

Â  Â  Â  Â  <form id="compraForm" class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-8">

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="fecha" class="mb-1 font-semibold text-[#1f2937]">Fecha:</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" id="fecha" required class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="cartaPorte" class="mb-1 font-semibold text-[#1f2937]">NÂ° Carta de Porte:</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" id="cartaPorte" placeholder="Ej: 123456789" required

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="producto" class="mb-1 font-semibold text-[#1f2937]">Producto:</label>

Â  Â  Â  Â  Â  Â  Â  Â  <select id="producto" required class="border border-[#1f2937] rounded px-3 py-2">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Soja">Soja</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="MaÃ­z">MaÃ­z</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Trigo">Trigo</option>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Cebada">Cebada</option>

Â  Â  Â  Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="kilos" class="mb-1 font-semibold text-[#1f2937]">Kilogramos:</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="kilos" placeholder="Ej: 1000" required

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="precio" class="mb-1 font-semibold text-[#1f2937]">Precio por kilo ($):</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="precio" placeholder="Ej: 0.50" step="0.01" required

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="descuento" class="mb-1 font-semibold text-[#1f2937]">Descuento (%):</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="descuento" value="0" placeholder="Ej: 5"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="flex flex-col">

Â  Â  Â  Â  Â  Â  Â  Â  <label for="impuesto" class="mb-1 font-semibold text-[#1f2937]">Impuesto (%):</label>

Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" id="impuesto" value="0" placeholder="Ej: 21"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-[#1f2937] rounded px-3 py-2" />

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="sm:col-span-2 flex justify-center mt-4">

Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" id="generateInvoiceBtn"

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-6 py-3 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generar Factura

Â  Â  Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </form>

Â  Â  </div>





Â  Â  <div id="factura-container"

Â  Â  Â  Â  class="hidden w-full max-w-3xl bg-white p-6 rounded-xl shadow-md mt-6 flex flex-col items-center">

Â  Â  Â  Â  <h2 class="text-2xl font-bold mb-4 text-[#1f2937]">PrevisualizaciÃ³n de Factura</h2>

Â  Â  Â  Â  <div id="factura-preview" class="w-full mb-6">



Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="factura-actions flex gap-4">

Â  Â  Â  Â  Â  Â  <button id="downloadPdfBtn"

Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-6 py-2 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Descargar Factura PDF

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <button id="newCalculationBtn"

Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-6 py-2 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Nuevo CÃ¡lculo

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  </div>

Â  Â  </div>





Â  Â  <div id="historial-container" class="max-w-3xl w-full p-6 mt-10 bg-white rounded-xl shadow-md">

Â  Â  Â  Â  <h2 class="text-center text-2xl font-bold mb-6 text-[#1f2937]">Historial de facturacion</h2>



Â  Â  Â  Â  <form id="filtroHistorial"

Â  Â  Â  Â  Â  Â  class="flex flex-wrap gap-2 items-center justify-start w-full max-w-5xl mx-auto mb-4">

Â  Â  Â  Â  Â  Â  <input type="date" id="filtroFechaDesde" class="border border-[#1f2937] rounded px-3 py-2 w-full sm:w-auto"

Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Desde" />

Â  Â  Â  Â  Â  Â  <input type="date" id="filtroFechaHasta" class="border border-[#1f2937] rounded px-3 py-2 w-full sm:w-auto"

Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Hasta" />

Â  Â  Â  Â  Â  Â  <input type="text" id="filtroCartaPorte" class="border border-[#1f2937] rounded px-3 py-2 w-full sm:w-auto"

Â  Â  Â  Â  Â  Â  Â  Â  placeholder="NÂ° Carta de Porte" />

Â  Â  Â  Â  Â  Â  <button type="submit"

Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-5 py-2 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Buscar

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <button type="button" id="limpiarFiltros"

Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-5 py-2 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Limpiar

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  Â  Â  <button type="button" id="verTodasFacturas"

Â  Â  Â  Â  Â  Â  Â  Â  class="bg-[#1f2937] text-white px-5 py-2 rounded shadow hover:bg-[#374151] transition font-semibold">

Â  Â  Â  Â  Â  Â  Â  Â  Todas las facturas

Â  Â  Â  Â  Â  Â  </button>

Â  Â  Â  Â  </form>



Â  Â  Â  Â  <div class="tabla-scroll-wrapper overflow-x-auto">

Â  Â  Â  Â  Â  Â  <table class="w-full text-left border-collapse border border-[#1f2937]">

Â  Â  Â  Â  Â  Â  Â  Â  <thead class="bg-[#1f2937] text-white">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">Fecha</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">NÂ°</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap ">Producto</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap ">Kilos</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">Precio</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">Descuento</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">Impuesto</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap">Total</th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th class="border border-[#1f2937] px-3 py-2 whitespace-nowrap"></th>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>

Â  Â  Â  Â  Â  Â  Â  Â  </thead>

Â  Â  Â  Â  Â  Â  Â  Â  <tbody id="tablaHistorialBody">

Â  Â  Â  Â  Â  Â  Â  Â  </tbody>

Â  Â  Â  Â  Â  Â  </table>

Â  Â  Â  Â  </div>

Â  Â  </div>

Â  Â  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

Â  Â  <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

Â  Â  <script src="js/main.js"></script>



</body>



</html>


JS : 
document.addEventListener("DOMContentLoaded", function () {

Â  Â  const compraForm = document.getElementById("compraForm");

Â  Â  const facturaContainer = document.getElementById("factura-container");

Â  Â  const facturaPreview = document.getElementById("factura-preview");

Â  Â  const downloadPdfBtn = document.getElementById("downloadPdfBtn");

Â  Â  const newCalculationBtn = document.getElementById("newCalculationBtn");



Â  Â  const today = new Date();

Â  Â  const yyyy = today.getFullYear();

Â  Â  const mm = String(today.getMonth() + 1).padStart(2, '0');

Â  Â  const dd = String(today.getDate()).padStart(2, '0');

Â  Â  document.getElementById("fecha").value = `${yyyy}-${mm}-${dd}`;





Â  Â  function showStatusMessage(message, type = "info") {

Â  Â  Â  Â  let statusDiv = document.getElementById("statusMessage");

Â  Â  Â  Â  if (!statusDiv) {

Â  Â  Â  Â  Â  Â  statusDiv = document.createElement("div");

Â  Â  Â  Â  Â  Â  statusDiv.id = "statusMessage";

Â  Â  Â  Â  Â  Â  document.body.appendChild(statusDiv);

Â  Â  Â  Â  }



Â  Â  Â  Â  statusDiv.textContent = message;

Â  Â  Â  Â  statusDiv.className = "";

Â  Â  Â  Â  statusDiv.classList.add("show");



Â  Â  Â  Â  if (type === "error") {

Â  Â  Â  Â  Â  Â  statusDiv.classList.add("error");

Â  Â  Â  Â  } else if (type === "success") {

Â  Â  Â  Â  Â  Â  statusDiv.classList.add("success");

Â  Â  Â  Â  } else {

Â  Â  Â  Â  Â  Â  statusDiv.classList.add("info");

Â  Â  Â  Â  }



Â  Â  Â  Â  statusDiv.style.display = "block";



Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  statusDiv.classList.remove("show");

Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.style.display = "none";

Â  Â  Â  Â  Â  Â  }, 400);

Â  Â  Â  Â  }, 5000);

Â  Â  }



Â  Â  function hideStatusMessage() {

Â  Â  Â  Â  const statusDiv = document.getElementById("statusMessage");

Â  Â  Â  Â  if (statusDiv) {

Â  Â  Â  Â  Â  Â  statusDiv.classList.remove("show");

Â  Â  Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  Â  Â  statusDiv.style.display = "none";

Â  Â  Â  Â  Â  Â  }, 400);

Â  Â  Â  Â  }

Â  Â  }



Â  Â  // Historial

Â  Â  function guardarFacturaEnHistorial(factura) {

Â  Â  Â  Â  const historial = JSON.parse(localStorage.getItem('historialFacturas')) || [];

Â  Â  Â  Â  historial.push(factura);

Â  Â  Â  Â  localStorage.setItem('historialFacturas', JSON.stringify(historial));

Â  Â  }



Â  Â  function cargarHistorial() {

Â  Â  Â  Â  return JSON.parse(localStorage.getItem('historialFacturas')) || [];

Â  Â  }



function renderizarHistorial(facturas) {

Â  Â  const tbody = document.getElementById('tablaHistorialBody');

Â  Â  tbody.innerHTML = '';



Â  Â  if (facturas.length === 0) {

Â  Â  Â  Â  tbody.innerHTML = `<tr><td colspan="9" class="text-center p-4">No se encontraron facturas</td></tr>`;

Â  Â  Â  Â  return;

Â  Â  }



Â  Â  facturas.forEach(factura => {

Â  Â  Â  Â  const tr = document.createElement('tr');

Â  Â  Â  Â  tr.classList.add('border-b', 'border-[#b89b5e]');



Â  Â  Â  Â  tr.innerHTML = `

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.fecha}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.cartaPorte}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.producto}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.kilos.toLocaleString('es-AR')}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">$${factura.precio.toFixed(2)}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.descuento}%</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">${factura.impuesto}%</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap">$${factura.totalFinal.toFixed(2)}</td>

Â  Â  Â  Â  Â  Â  <td class="border border-[#b89b5e] px-3 py-1 whitespace-nowrap text-center">

Â  Â  Â  Â  Â  Â  Â  Â  <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded eliminar-btn transition duration-200" data-carta="${factura.cartaPorte}">

Â  Â  Eliminar

</button>

Â  Â  Â  Â  Â  Â  </td>

Â  Â  Â  Â  `;

Â  Â  Â  Â  tbody.appendChild(tr);

Â  Â  });



document.querySelectorAll('.eliminar-btn').forEach(btn => {

Â  Â  btn.addEventListener('click', function () {

Â  Â  Â  Â  const carta = this.getAttribute('data-carta');



Swal.fire({

Â  Â  title: 'Â¿EstÃ¡s seguro?',

Â  Â  text: `Vas a eliminar la factura NÂ° ${carta}`,

Â  Â  icon: 'warning',

Â  Â  showCancelButton: true,

Â  Â  confirmButtonColor: '#c19a43',

Â  Â  cancelButtonColor: '#d33',

Â  Â  confirmButtonText: 'SÃ­, eliminar',

Â  Â  cancelButtonText: 'Cancelar',

Â  Â  customClass: {

Â  Â  Â  Â  popup: 'my-responsive-popup'

Â  Â  }

})

.then((result) => {

Â  Â  if (result.isConfirmed) {

Â  Â  Â  Â  eliminarFactura(carta);



Â  Â  Â  Â  Swal.fire({

Â  Â  Â  Â title: 'ðŸ—‘ï¸ Eliminada',

Â  text: `La factura fue eliminada correctamente.`,

Â  icon: 'success',

Â  confirmButtonColor: '#c19a43',

Â  customClass: {

Â  Â  popup: 'my-responsive-popup'

Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  });

Â  Â  }

});

Â  Â  });

});

}



Â  Â  function filtrarHistorial(event) {

Â  Â  Â  Â  event.preventDefault();



Â  Â  Â  Â  const desde = document.getElementById('filtroFechaDesde').value;

Â  Â  Â  Â  const hasta = document.getElementById('filtroFechaHasta').value;

Â  Â  Â  Â  const carta = document.getElementById('filtroCartaPorte').value.trim().toLowerCase();



Â  Â  Â  Â  let facturas = cargarHistorial();



Â  Â  Â  Â  if (desde) {

Â  Â  Â  Â  Â  Â  facturas = facturas.filter(f => f.fecha >= desde);

Â  Â  Â  Â  }

Â  Â  Â  Â  if (hasta) {

Â  Â  Â  Â  Â  Â  facturas = facturas.filter(f => f.fecha <= hasta);

Â  Â  Â  Â  }

Â  Â  Â  Â  if (carta) {

Â  Â  Â  Â  Â  Â  facturas = facturas.filter(f => f.cartaPorte.toLowerCase().includes(carta));

Â  Â  Â  Â  }



Â  Â  Â  Â  renderizarHistorial(facturas);

Â  Â  }



Â  Â  function limpiarFiltros() {

Â  Â  Â  Â  document.getElementById('filtroFechaDesde').value = '';

Â  Â  Â  Â  document.getElementById('filtroFechaHasta').value = '';

Â  Â  Â  Â  document.getElementById('filtroCartaPorte').value = '';

Â  Â  Â  Â  renderizarHistorial([]);

Â  Â  }



Â  Â  compraForm.addEventListener("submit", function (e) {

Â  Â  Â  Â  e.preventDefault();



Â  Â  Â  Â  const fecha = document.getElementById("fecha").value;

Â  Â  Â  Â  const cartaPorte = document.getElementById("cartaPorte").value.trim();

Â  Â  Â  Â  const producto = document.getElementById("producto").value;

Â  Â  Â  Â  const kilos = parseFloat(document.getElementById("kilos").value);

Â  Â  Â  Â  const precio = parseFloat(document.getElementById("precio").value);

Â  Â  Â  Â  const descuento = parseFloat(document.getElementById("descuento").value) || 0;

Â  Â  Â  Â  const impuesto = parseFloat(document.getElementById("impuesto").value) || 0;



Â  Â  Â  Â  if (isNaN(kilos) || isNaN(precio) || kilos <= 0 || precio <= 0) {

Â  Â  Â  Â  Â  Â  showStatusMessage("Por favor, ingrese valores vÃ¡lidos y positivos para Kilogramos y Precio por Kilo.", "error");

Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  const subtotal = kilos * precio;

Â  Â  Â  Â  const descuentoMonto = subtotal * (descuento / 100);

Â  Â  Â  Â  const impuestoMonto = subtotal * (impuesto / 100);

Â  Â  Â  Â  const totalFinal = subtotal - descuentoMonto + impuestoMonto;



Â  Â  Â  Â  facturaPreview.innerHTML = `

Â  Â  Â  Â  Â  Â  <div style="padding: 20px; font-family: sans-serif; border: 1px solid #000; margin: 0 auto; max-width: 600px;">

Â  Â  Â  Â  Â  Â  Â  Â  <h2 style="text-align: center;">Comprobante de Compra â€“ No Fiscal</h2>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Fecha:</strong> ${fecha}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>NÂ° Carta de Porte:</strong> ${cartaPorte}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <hr style="border-top: 1px dashed #ccc; margin: 10px 0;">

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Producto:</strong> ${producto}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Kilogramos:</strong> ${kilos.toLocaleString('es-AR', { maximumFractionDigits: 2 })} kg</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Precio por kilo:</strong> $${precio.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Subtotal:</strong> $${subtotal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Descuento (${descuento}%):</strong> -$${descuentoMonto.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <p><strong>Impuesto (${impuesto}%):</strong> +$${impuestoMonto.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>

Â  Â  Â  Â  Â  Â  Â  Â  <hr style="border-top: 1px solid #000; margin: 10px 0;">

Â  Â  Â  Â  Â  Â  Â  Â  <h3 style="text-align: right;"><strong>Total Final:</strong> $${totalFinal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</h3>

Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  `;



Â  Â  Â  Â  guardarFacturaEnHistorial({

Â  Â  Â  Â  Â  Â  fecha,

Â  Â  Â  Â  Â  Â  cartaPorte,

Â  Â  Â  Â  Â  Â  producto,

Â  Â  Â  Â  Â  Â  kilos,

Â  Â  Â  Â  Â  Â  precio,

Â  Â  Â  Â  Â  Â  descuento,

Â  Â  Â  Â  Â  Â  impuesto,

Â  Â  Â  Â  Â  Â  totalFinal

Â  Â  Â  Â  });



Â  Â  Â  Â  facturaContainer.style.display = "flex";

Â  Â  Â  Â  compraForm.style.display = "none";



Â  Â  Â  Â  renderizarHistorial(cargarHistorial());

Â  Â  });



Â  Â  downloadPdfBtn.addEventListener("click", function () {

Â  Â  Â  Â  const cartaPorte = document.getElementById("cartaPorte").value.trim();

Â  Â  Â  Â  if (!cartaPorte) {

Â  Â  Â  Â  Â  Â  showStatusMessage("Debe ingresar el NÂ° de Carta de Porte para descargar la factura.", "error");

Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  }



Â  Â  Â  Â  facturaContainer.style.display = "flex";

Â  Â  Â  Â  setTimeout(() => {

Â  Â  Â  Â  Â  Â  if (typeof window.jspdf === 'undefined' || typeof window.jspdf.jsPDF === 'undefined') {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error: La librerÃ­a jsPDF no estÃ¡ cargada o no estÃ¡ definida correctamente.");

Â  Â  Â  Â  Â  Â  Â  Â  showStatusMessage("Error: La librerÃ­a jsPDF no estÃ¡ cargada. Revise la consola del navegador.", "error");

Â  Â  Â  Â  Â  Â  Â  Â  return;

Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  const { jsPDF } = window.jspdf;

Â  Â  Â  Â  Â  Â  html2canvas(facturaPreview, {

Â  Â  Â  Â  Â  Â  Â  Â  scale: 2,

Â  Â  Â  Â  Â  Â  Â  Â  useCORS: true

Â  Â  Â  Â  Â  Â  }).then(canvas => {

Â  Â  Â  Â  Â  Â  Â  Â  const imgData = canvas.toDataURL("image/png");

Â  Â  Â  Â  Â  Â  Â  Â  const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });



Â  Â  Â  Â  Â  Â  Â  Â  const imgWidth = 210;

Â  Â  Â  Â  Â  Â  Â  Â  const pageHeight = 297;

Â  Â  Â  Â  Â  Â  Â  Â  const imgHeight = canvas.height * imgWidth / canvas.width;

Â  Â  Â  Â  Â  Â  Â  Â  let heightLeft = imgHeight;

Â  Â  Â  Â  Â  Â  Â  Â  let position = 0;



Â  Â  Â  Â  Â  Â  Â  Â  pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);

Â  Â  Â  Â  Â  Â  Â  Â  heightLeft -= pageHeight;



Â  Â  Â  Â  Â  Â  Â  Â  while (heightLeft >= 0) {

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  position = heightLeft - imgHeight;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdf.addPage();

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  heightLeft -= pageHeight;

Â  Â  Â  Â  Â  Â  Â  Â  }



Â  Â  Â  Â  Â  Â  Â  Â  pdf.save(`factura-${cartaPorte}.pdf`);

Â  Â  Â  Â  Â  Â  Â  Â  showStatusMessage("Factura descargada correctamente.", "success");

Â  Â  Â  Â  Â  Â  }).catch(error => {

Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error al generar el PDF con html2canvas:", error);

Â  Â  Â  Â  Â  Â  Â  Â  showStatusMessage("Hubo un error al generar el PDF. Por favor, intÃ©ntelo de nuevo.", "error");

Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  }, 50);

Â  Â  });



Â  Â  newCalculationBtn.addEventListener("click", function () {

Â  Â  Â  Â  compraForm.reset();

Â  Â  Â  Â  document.getElementById("fecha").value = `${yyyy}-${mm}-${dd}`;

Â  Â  Â  Â  facturaContainer.style.display = "none";

Â  Â  Â  Â  compraForm.style.display = "grid";

Â  Â  Â  Â  facturaPreview.innerHTML = '';

Â  Â  Â  Â  hideStatusMessage();

Â  Â  });



Â  Â  document.getElementById('filtroHistorial').addEventListener('submit', filtrarHistorial);

Â  Â  document.getElementById('limpiarFiltros').addEventListener('click', limpiarFiltros);



Â  Â  document.getElementById('verTodasFacturas').addEventListener('click', function () {

Â  Â  Â  Â  const todas = cargarHistorial();

Â  Â  Â  Â  if (todas.length === 0) {

Â  Â  Â  Â  Â  Â  showStatusMessage("No hay facturas guardadas para mostrar.", "info");

Â  Â  Â  Â  }

Â  Â  Â  Â  renderizarHistorial(todas);

Â  Â  });



Â  Â  renderizarHistorial([]);



Â  Â  function eliminarFactura(cartaPorte) {

Â  Â  let historial = cargarHistorial();

Â  Â  const nuevoHistorial = historial.filter(f => f.cartaPorte !== cartaPorte);

Â  Â  localStorage.setItem('historialFacturas', JSON.stringify(nuevoHistorial));

Â  Â  renderizarHistorial(nuevoHistorial);

Â  Â  showStatusMessage("Factura eliminada correctamente.", "success");

}



});


css


body,

input,

select,

button {

Â  Â  font-family: 'Inter', sans-serif;

Â  Â  background-color: #f5f0e6;

Â  Â  color: #4b3b22;

Â  Â  margin: 0;

Â  Â  padding: 0;

Â  Â  box-sizing: border-box;

}



#app-container {

Â  Â  max-width: 480px;

Â  Â  margin: 2rem auto;

Â  Â  background: #f5f0e6;

Â  Â  padding: 2rem;

Â  Â  border-radius: 12px;

Â  Â  box-shadow: 0 8px 20px rgba(101, 67, 33, 0.2);

Â  Â  color: #4b3b22;

}





#app-container h1 {

Â  Â  text-align: center;

Â  Â  font-weight: 700;

Â  Â  font-size: 1.9rem;

Â  Â  margin-bottom: 1.5rem;

Â  Â  color: #594f30;

Â  Â  text-shadow: 1px 1px 0 rgba(89, 79, 48, 0.3);

}



#statusMessage {

Â  Â  position: fixed;

Â  Â  top: 20px;

Â  Â  left: 50%;

Â  Â  transform: translateX(-50%);

Â  Â  padding: 10px 20px;

Â  Â  border-radius: 5px;

Â  Â  z-index: 1000;

Â  Â  color: white;

Â  Â  font-weight: bold;

Â  Â  text-align: center;

Â  Â  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);

Â  Â  opacity: 0;

Â  Â  pointer-events: none;

Â  Â  transition: opacity 0.3s ease;

}



#statusMessage.show {

Â  Â  opacity: 1;

Â  Â  pointer-events: auto;

}



#statusMessage.error {

Â  Â  background-color: #dc3545;

}



#statusMessage.success {

Â  Â  background-color: #28a745;

}



#statusMessage.info {

Â  Â  background-color: #007bff;

}



/* Formularios */

.form-group {

Â  Â  display: flex;

Â  Â  flex-direction: column;

Â  Â  margin-bottom: 1rem;

}



.form-group label {

Â  Â  font-weight: 600;

Â  Â  margin-bottom: 0.35rem;

Â  Â  color: #3a3a2d;

}







input[type="date"],

input[type="text"],

input[type="number"],

select {

Â  Â  padding: 0.5rem 0.75rem;

Â  Â  border: 2px solid #b89b5e;

Â  Â  border-radius: 8px;

Â  Â  font-size: 1rem;

Â  Â  color: #4b3b22;

Â  Â  background-color: #fefcf6;

Â  Â  transition: border-color 0.3s ease, box-shadow 0.3s ease;

Â  Â  width: 100%;

Â  Â  box-sizing: border-box;

}



input[type="date"]:focus,

input[type="text"]:focus,

input[type="number"]:focus,

select:focus {

Â  Â  border-color: #4a5d23;

Â  Â  box-shadow: 0 0 6px #4a5d23aa;

Â  Â  outline: none;

}





button {

Â  Â  background-color: #c19a43;

Â  Â  border: none;

Â  Â  color: #ffffff;

Â  Â  font-weight: 700;

Â  Â  font-size: 1.1rem;

Â  Â  padding: 0.75rem 1.8rem;

Â  Â  border-radius: 14px;

Â  Â  cursor: pointer;

Â  Â  box-shadow: 0 6px 14px rgba(193, 154, 67, 0.8);

Â  Â  transition: background-color 0.3s ease, box-shadow 0.3s ease;

Â  Â  align-self: center;

Â  Â  user-select: none;

}



button:hover,

button:focus {

Â  Â  background-color: #4a5d23;

Â  Â  box-shadow: 0 8px 20px rgba(74, 93, 35, 0.9);

Â  Â  color: #ffffff;

Â  Â  outline: none;

}



button:active {

Â  Â  box-shadow: 0 3px 8px rgba(74, 93, 35, 0.7);

}





.factura-actions button {

Â  Â  width: 160px;

Â  Â  background-color: #594f30;

Â  Â  box-shadow: 0 5px 10px rgba(89, 79, 48, 0.7);

Â  Â  color: #ffffff;

Â  Â  transition: background-color 0.3s ease, box-shadow 0.3s ease;

Â  Â  user-select: none;

}



.factura-actions button:hover,

.factura-actions button:focus {

Â  Â  background-color: #4a5d23;

Â  Â  box-shadow: 0 6px 14px rgba(74, 93, 35, 0.9);

Â  Â  outline: none;

}



.factura-actions button:active {

Â  Â  box-shadow: 0 3px 8px rgba(74, 93, 35, 0.7);

}





#compraForm {

Â  Â  display: grid;

Â  Â  grid-template-columns: 1fr;

Â  Â  gap: 1rem;

}





.form-actions {

Â  Â  margin-top: 1rem;

Â  Â  display: flex;

Â  Â  justify-content: center;

}





#factura-container {

Â  Â  max-width: 600px;

Â  Â  margin: 2rem auto;

Â  Â  padding: 1.5rem 2rem;

Â  Â  background-color: #fefcf6;

Â  Â  /* beige */

Â  Â  border-radius: 14px;

Â  Â  box-shadow: 0 8px 18px rgba(101, 67, 33, 0.25);

Â  Â  color: #4b3b22;

Â  Â  display: none;

Â  Â  flex-direction: column;

Â  Â  gap: 1rem;

}



#factura-container h2 {

Â  Â  text-align: center;

Â  Â  font-weight: 700;

Â  Â  font-size: 1.8rem;

Â  Â  color: #594f30;

Â  Â  text-shadow: 1px 1px 0 rgba(89, 79, 48, 0.3);

Â  Â  margin-bottom: 0.75rem;

}





#factura-preview>div {

Â  Â  border: 2px solid #b89b5e;

Â  Â  padding: 1.5rem 2rem;

Â  Â  border-radius: 12px;

Â  Â  background-color: #fffbe6;

Â  Â  box-shadow: inset 0 0 10px #b89b5e55;

Â  Â  font-size: 1rem;

Â  Â  color: #4b3b22;

Â  Â  line-height: 1.5;

}



#factura-preview p {

Â  Â  margin: 0.4rem 0;

}



#factura-preview hr {

Â  Â  border-color: #b89b5e88;

}





#factura-preview h3 {

Â  Â  font-weight: 700;

Â  Â  color: #4a5d23;

}





.factura-actions {

Â  Â  display: flex;

Â  Â  justify-content: center;

Â  Â  gap: 1rem;

Â  Â  margin-top: 1rem;

}







#statusMessage {

Â  Â  font-size: 1.05rem;

Â  Â  letter-spacing: 0.02em;

Â  Â  user-select: none;

Â  Â  font-family: 'Inter', sans-serif;

}





.tabla-scroll-wrapper {

Â  Â  width: 100%;

Â  Â  overflow-x: auto;

}





@media (max-width: 480px) {



Â  Â  #app-container,

Â  Â  #factura-container {

Â  Â  Â  Â  margin: 1rem;

Â  Â  Â  Â  padding: 1.5rem;

Â  Â  Â  Â  max-width: 100%;

Â  Â  }



Â  Â  #compraForm {

Â  Â  Â  Â  grid-template-columns: 1fr;

Â  Â  Â  Â  gap: 0.8rem;

Â  Â  }



Â  Â  #filtroHistorial {

Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  align-items: stretch;

Â  Â  }



Â  Â  #filtroHistorial input,

Â  Â  #filtroHistorial button {

Â  Â  Â  Â  width: 100%;

Â  Â  }



Â  Â  input[type="date"],

Â  Â  input[type="text"],

Â  Â  input[type="number"],

Â  Â  select {

Â  Â  Â  Â  width: 100%;

Â  Â  }



Â  Â  button {

Â  Â  Â  Â  width: 100%;

Â  Â  Â  Â  padding: 0.85rem 1rem;

Â  Â  Â  Â  font-size: 1.05rem;

Â  Â  }



Â  Â  .factura-actions {

Â  Â  Â  Â  flex-direction: column;

Â  Â  Â  Â  gap: 0.8rem;

Â  Â  }



Â  Â  .factura-actions button {

Â  Â  Â  Â  width: 100%;

Â  Â  }

}





@media (min-width: 600px) {

Â  Â  #compraForm {

Â  Â  Â  Â  grid-template-columns: repeat(2, 1fr);

Â  Â  Â  Â  gap: 1.5rem 2rem;

Â  Â  }



Â  Â  .form-group label {

Â  Â  Â  Â  margin-bottom: 0.5rem;

Â  Â  }



Â  Â  .factura-actions button {

Â  Â  Â  Â  width: 160px;

Â  Â  Â  Â  padding: 0.75rem 1.8rem;

Â  Â  Â  Â  font-size: 1.1rem;

Â  Â  }

}









@media (min-width: 1024px) {



Â  Â  #app-container,

Â  Â  #factura-container {

Â  Â  Â  Â  max-width: 600px;

Â  Â  Â  Â  padding: 3rem 4rem;

Â  Â  Â  Â  margin: 3rem auto;

Â  Â  }



Â  Â  #compraForm {

Â  Â  Â  Â  grid-template-columns: 1fr;

Â  Â  Â  Â  gap: 1.5rem;

Â  Â  }



Â  Â  .form-group label {

Â  Â  Â  Â  font-size: 1.1rem;

Â  Â  Â  Â  margin-bottom: 0.6rem;

Â  Â  }



Â  Â  input[type="date"],

Â  Â  input[type="text"],

Â  Â  input[type="number"],

Â  Â  select {

Â  Â  Â  Â  font-size: 1.1rem;

Â  Â  Â  Â  padding: 0.75rem 1rem;

Â  Â  }



Â  Â  button {

Â  Â  Â  Â  font-size: 1.2rem;

Â  Â  Â  Â  padding: 1rem 2.5rem;

Â  Â  }



Â  Â  .factura-actions button {

Â  Â  Â  Â  width: 180px;

Â  Â  Â  Â  font-size: 1.15rem;

Â  Â  Â  Â  padding: 0.9rem 2.2rem;

Â  Â  }



Â  Â  #factura-preview>div {

Â  Â  Â  Â  padding: 2rem 3rem;

Â  Â  Â  Â  font-size: 1.1rem;

Â  Â  }



Â  Â  #factura-container h2 {

Â  Â  Â  Â  font-size: 2.2rem;

Â  Â  }

}



.my-responsive-popup {

Â  Â  width: 90% !important;

Â  Â  max-width: 400px !important;

Â  Â  font-size: 1rem !important;

}





@media (max-width: 400px) {

Â  Â  .my-responsive-popup {

Â  Â  Â  Â  width: 95% !important;

Â  Â  Â  Â  font-size: 0.9rem !important;

Â  Â  }

}





.my-responsive-popup .swal2-title {

Â  Â  font-size: 1.3rem !important;

}



@media (max-width: 400px) {

Â  Â  .my-responsive-popup .swal2-title {

Â  Â  Â  Â  font-size: 1.1rem !important;

Â  Â  }

}





.my-responsive-popup .swal2-html-container {

Â  Â  font-size: 1rem !important;

}



@media (max-width: 400px) {

Â  Â  .my-responsive-popup .swal2-html-container {

Â  Â  Â  Â  font-size: 0.9rem !important;

Â  Â  }

}